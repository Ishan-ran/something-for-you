<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For Miss Blue üíô</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.13/lottie.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Fredoka+One&family=Indie+Flower&family=Quicksand:wght@400;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- 1. THEME & BASICS --- */
        body {
            background-color: #ffecf0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; margin: 0;
            font-family: 'Quicksand', sans-serif;
            overflow: hidden; color: #590d22;
            /* FEATURE 2: CUSTOM CURSOR */
            cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewport='0 0 100 100' style='fill:black;font-size:24px;'><text y='50%'>üíñ</text></svg>") 16 0, auto;
            -webkit-tap-highlight-color: transparent;
            opacity: 0; animation: cinematicFade 2s forwards ease-in-out;
        }

        /* Override cursor for buttons to be a pointer hand with a heart */
        button, .gift-wrapper, #musicControl, .playlist-card {
            cursor: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewport='0 0 100 100' style='fill:black;font-size:24px;'><text y='50%'>üëÜ</text></svg>") 16 0, pointer;
        }

        @keyframes cinematicFade { to { opacity: 1; } }

        /* --- 2. VIDEO BACKGROUND --- */
        #bgVideo {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: -2; opacity: 0.6;
        }
        .video-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 236, 240, 0.3); backdrop-filter: blur(5px);
            z-index: -1; pointer-events: none;
        }

        /* --- 3. SHIMMERING TEXT EFFECT --- */
        .shimmer-text {
            font-family: 'Fredoka One', cursive; 
            font-size: 3rem; margin-bottom: 10px;
            background: linear-gradient(to right, #ff4d6d 20%, #ff8fa3 40%, #ffb3c1 60%, #ff4d6d 80%);
            background-size: 200% auto;
            color: #ff4d6d;
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            animation: shine 3s linear infinite;
            text-shadow: 0 0 20px rgba(255, 77, 109, 0.3);
        }
        @keyframes shine { to { background-position: 200% center; } }
        p { font-size: 1.2rem; color: #590d22; font-weight: 700; text-shadow: 0 1px 1px rgba(255,255,255,0.8); }

        /* --- 4. FLOATING BUTTERFLY --- */
        #blueFollowerContainer {
            position: fixed; width: 150px; height: 150px;
            z-index: 50; pointer-events: none;
            top: 0; left: 0; will-change: transform;
        }

        /* --- 5. UI CONTAINERS --- */
        .container {
            text-align: center; z-index: 10;
            transition: opacity 0.5s ease; width: 90%; max-width: 500px;
        }
        .hidden { display: none !important; opacity: 0; }
        .visible { display: block !important; opacity: 1; }

        /* --- 6. BUTTONS --- */
        .btn-container { display: flex; justify-content: center; gap: 15px; margin-top: 50px; }
        button {
            padding: 15px 30px; font-family: 'Fredoka One', cursive; font-size: 1rem;
            border: none; border-radius: 50px; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: transform 0.2s;
            z-index: 20; 
        }
        button:active { transform: translateY(4px); box-shadow: none; }
        .btn-yes { background: #ff4d6d; color: white; }
        .btn-yes:hover { transform: scale(1.1); box-shadow: 0 0 20px rgba(255, 77, 109, 0.6); }
        .btn-no { 
            background: #a2d2ff; 
            color: #003049; 
            white-space: nowrap; 
            /* Added smooth transition for position changes */
            transition: left 0.4s ease, top 0.4s ease, transform 0.2s; 
        }

        /* --- 7. PARTICLE EXPLOSION --- */
        .particle {
            position: absolute; width: 8px; height: 8px;
            border-radius: 50%; pointer-events: none; z-index: 9999;
        }
        @keyframes explode {
            0% { transform: translate(0,0) scale(1); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
        }

        /* --- 8. NEW BUBBLE GIFT MENU --- */
        .gift-grid { 
            display: flex; gap: 30px; justify-content: center; margin-top: 40px; flex-wrap: wrap; 
        }

        /* Wrapper for Bubble + Label */
        .gift-wrapper {
            display: flex; flex-direction: column; align-items: center; position: relative;
        }

        /* The Bubble Button */
        .gift-bubble {
            width: 100px; height: 100px;
            border-radius: 50%;
            background: white;
            /* Soft pink inner shadow for depth + outer drop shadow */
            box-shadow: inset 0 -5px 10px rgba(255, 77, 109, 0.1), 
                        0 15px 30px rgba(255, 77, 109, 0.2);
            border: 4px solid white;
            display: flex; align-items: center; justify-content: center;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow: hidden; /* Crops image to circle */
            
            /* Floating Animation */
            animation: floatBubble 4s ease-in-out infinite;
        }
        
        .gift-bubble img {
            width: 100%; height: 100%;
            object-fit: cover; /* Ensures image fills circle perfectly */
            display: block; pointer-events: none;
        }

        /* Offset animations */
        .gift-wrapper:nth-child(odd) .gift-bubble { animation-delay: 0s; }
        .gift-wrapper:nth-child(even) .gift-bubble { animation-delay: 2s; }

        /* Hover Effects */
        .gift-wrapper:hover .gift-bubble {
            transform: scale(1.15) translateY(-10px);
            border-color: #ff4d6d;
            box-shadow: 0 20px 40px rgba(255, 77, 109, 0.4);
            background: #fff0f5;
        }
        .gift-wrapper:active .gift-bubble { transform: scale(0.95); }

        /* Label Styling */
        .gift-label {
            margin-top: 15px;
            font-family: 'Fredoka One', cursive;
            font-size: 1rem; color: #ff4d6d;
            letter-spacing: 0.5px; opacity: 0.8; transition: 0.3s;
        }
        .gift-wrapper:hover .gift-label {
            opacity: 1; transform: translateY(5px); color: #d90429;
        }

        @keyframes floatBubble {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-15px); }
        }

        /* --- 9. OVERLAYS --- */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 100;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            animation: fadeIn 0.4s;
            backdrop-filter: blur(8px);
        }
        @keyframes fadeIn { from{opacity:0;} to{opacity:1;} }
        
        .close-btn { 
            margin-top: 20px; background: #ff4d6d; color: white; 
            border: none; padding: 10px 25px; 
            border-radius: 30px; font-weight: bold; font-family: 'Quicksand';
            box-shadow: 0 5px 15px rgba(255, 77, 109, 0.4);
        }

        /* --- 10. LETTER CARD STYLE --- */
        .letter-paper {
            background: #fff; 
            width: 85%; max-width: 500px; height: 65vh; 
            padding: 40px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2); 
            border-radius: 20px; 
            
            font-family: 'Quicksand', sans-serif; 
            font-weight: 500; font-size: 1.1rem; line-height: 1.8; color: #555; 
            
            text-align: left; overflow-y: auto; position: relative;
            border: 4px solid #fff0f5; 
        }
        .letter-paper::-webkit-scrollbar { width: 6px; }
        .letter-paper::-webkit-scrollbar-thumb { background: #ffccd5; border-radius: 10px; }

        .letter-title {
            font-family: 'Indie Flower', cursive;
            font-size: 2.2rem; color: #590d22; text-align: center;
            margin-bottom: 30px; font-weight: bold;
        }

        /* Decor Flowers */
        .deco-flower {
            position: absolute; font-size: 1.8rem; pointer-events: none;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float { 0%{transform:translateY(0);} 50%{transform:translateY(-5px);} 100%{transform:translateY(0);} }

        /* HIGHLIGHT CLASS FOR LETTER */
        .highlight { background: rgba(255, 204, 213, 0.3); padding: 0 5px; border-radius: 4px; color: #ff4d6d; font-weight: bold;}

        /* LETTER CONTENT STYLING */
        #letterContent {
            font-family: 'Indie Flower', cursive;
            background: linear-gradient(135deg, #DC143C, #4169E1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            color: #DC143C;
        }

        /* --- OTHER ASSETS --- */
        .flower-stage { font-size: 5rem; transition: transform 0.2s; }
        .flower-stage:active { transform: scale(0.9); }
        #lottieValentine { width: 300px; height: 300px; display: none; }
        #lottieCherry { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: none; opacity: 0.6; }
        .wrapped-box { font-size: 6rem; transition: transform 0.1s; }
        .shake { animation: shake 0.5s; }
        #lottieChocolate { width: 280px; height: 280px; display: none; }
        
        .touch-heart {
            position: fixed; pointer-events: none; font-size: 1.5rem;
            animation: floatUp 1s ease-out forwards; z-index: 50;
        }
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-50px) scale(1.5); opacity: 0; }
        }

        /* --- MUSIC PLAYER STYLES --- */
        #musicControl {
            position: fixed; top: 20px; right: 20px; z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px; border-radius: 30px;
            box-shadow: 0 4px 15px rgba(255, 77, 109, 0.3);
            display: flex; align-items: center; gap: 10px;
            border: 2px solid #ffccd5; transition: 0.3s;
        }
        #musicControl:hover { transform: scale(1.05); border-color: #ff4d6d; }
        .note-icon { font-size: 1.2rem; animation: spin 4s linear infinite; }
        #currentSongLabel { font-size: 0.9rem; font-weight: bold; color: #ff4d6d; max-width: 150px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* FEATURE 5: MUSIC TOAST */
        #musicToast {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-150px);
            background: rgba(255, 255, 255, 0.95); padding: 12px 30px; border-radius: 50px;
            box-shadow: 0 10px 30px rgba(255, 77, 109, 0.3);
            font-family: 'Fredoka One'; color: #ff4d6d; z-index: 3000;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            border: 2px solid #ffccd5;
            display: flex; align-items: center; gap: 10px;
        }
        .show-toast { transform: translateX(-50%) translateY(0) !important; }

        /* FEATURE 4: PRE-LOADER */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff0f5; z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.8s ease;
        }

        .playlist-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.4); z-index: 2000;
            backdrop-filter: blur(5px);
            display: none; align-items: center; justify-content: center;
            opacity: 0; transition: opacity 0.3s; flex-direction: column;
        }
        .playlist-overlay.show { display: flex; opacity: 1; }

        .playlist-card {
            width: 90%; max-width: 380px; height: 70vh;
            background: #fff; border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: flex; flex-direction: column; overflow: hidden;
        }

        .playlist-header {
            padding: 20px; background: #ff4d6d; color: white;
            display: flex; justify-content: space-between; align-items: center;
        }
        .playlist-header h2 { margin: 0; font-family: 'Fredoka One'; font-size: 1.5rem; }
        .close-plist { background: none; border: none; color: white; font-size: 1.5rem; }

        .playlist-scroll {
            flex: 1; overflow-y: auto; padding: 20px;
            font-family: 'Quicksand', sans-serif;
        }
        
        /* Footer for Player Controls inside the list */
        .playlist-footer {
            padding: 15px; background: #fff0f5;
            border-top: 1px solid #ffccd5;
            display: flex; justify-content: center; align-items: center; gap: 20px;
        }
        .playlist-footer .ctrl-btn {
            background: white; border: none; font-size: 1.2rem; color: #ff4d6d;
            width: 45px; height: 45px; border-radius: 50%;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: 0.2s;
            display: flex; align-items: center; justify-content: center;
        }
        .playlist-footer .ctrl-btn:hover { transform: scale(1.1); background: #ff4d6d; color: white; }
        .playlist-footer .play-pause-btn {
            width: 60px; height: 60px; font-size: 1.5rem;
            background: #ff4d6d; color: white;
            box-shadow: 0 5px 15px rgba(255, 77, 109, 0.4);
        }
        .playlist-footer .play-pause-btn:hover { background: #ff3355; }

        .genre-section { margin-bottom: 25px; }
        .genre-section h3 {
            font-size: 0.9rem; text-transform: uppercase; color: #888;
            margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;
        }

        .track-item {
            display: flex; align-items: center; gap: 15px;
            padding: 10px; border-radius: 12px;
            transition: 0.2s; border: 1px solid transparent;
        }
        .track-item:hover { background: #fff0f5; border-color: #ffccd5; }
        .track-item .icon { font-size: 1.5rem; }
        .track-item .info { flex: 1; text-align: left; }
        .track-item small { color: #888; font-size: 0.8rem; }

        /* Special Song Highlight */
        .special-section h3 { color: #ff4d6d; font-weight: bold; }
        .special-track {
            background: linear-gradient(135deg, #fff0f3, #ffe6e9);
            border: 1px solid #ff4d6d;
            animation: pulseBorder 2s infinite;
        }
        @keyframes pulseBorder { 0% { box-shadow: 0 0 0 0 rgba(255, 77, 109, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(255, 77, 109, 0); } 100% { box-shadow: 0 0 0 0 rgba(255, 77, 109, 0); } }

        /* --- RESPONSIVE DESIGN FOR MOBILE & PC --- */
        /* MOBILE MODE */
        @media (max-width: 768px) {
            .shimmer-text { font-size: 2rem; }
            p { font-size: 1rem; }
            button { padding: 12px 24px; font-size: 0.9rem; }
            .btn-container { gap: 10px; margin-top: 30px; }
            
            .gift-grid { gap: 10px; margin-top: 20px; }
            .gift-box { width: 80px; height: 100px; }
            .icon { font-size: 1.5rem; }
            .label { font-size: 0.8rem; }
            
            .letter-paper { width: 90%; max-width: 100%; height: 70vh; padding: 20px; font-size: 1rem; }
            .letter-title { font-size: 1.8rem; margin-bottom: 20px; }
            
            .playlist-card { width: 95%; max-width: 100%; height: 75vh; }
            .playlist-header { padding: 15px; }
            .playlist-header h2 { font-size: 1.2rem; }
            .playlist-scroll { padding: 15px; }
            
            #musicControl { padding: 8px 15px; font-size: 0.8rem; top: 10px; right: 10px; }
            #currentSongLabel { max-width: 100px; font-size: 0.8rem; }
            
            #playerControls { width: 95%; max-width: 100%; padding: 12px; bottom: 15px; }
            .ctrl-btn { font-size: 1.2rem; }
            .play-pause-btn { width: 45px; height: 45px; font-size: 1.2rem; }
        }

        /* PC MODE */
        @media (min-width: 769px) {
            .shimmer-text { font-size: 3.5rem; }
            p { font-size: 1.2rem; }
            button { padding: 15px 35px; font-size: 1.1rem; }
            .btn-container { gap: 20px; margin-top: 60px; }
            
            .gift-grid { gap: 20px; margin-top: 40px; }
            .gift-box { width: 120px; height: 140px; }
            .icon { font-size: 2.5rem; }
            .label { font-size: 1rem; }
            
            .letter-paper { width: 85%; max-width: 550px; height: 70vh; padding: 45px; font-size: 1.1rem; }
            .letter-title { font-size: 2.5rem; margin-bottom: 35px; }
            
            .playlist-card { width: 90%; max-width: 400px; height: 70vh; }
            .playlist-header { padding: 25px; }
            .playlist-header h2 { font-size: 1.8rem; }
            .playlist-scroll { padding: 25px; }
            
            #musicControl { padding: 12px 25px; font-size: 1rem; top: 25px; right: 25px; }
            #currentSongLabel { max-width: 180px; font-size: 1rem; }
            
            #playerControls { width: 90%; max-width: 380px; padding: 18px; bottom: 25px; }
            .ctrl-btn { font-size: 1.8rem; }
            .play-pause-btn { width: 55px; height: 55px; font-size: 1.6rem; }
        }

    </style>
</head>
<body>

    <!-- PRE-LOADER -->
    <div id="loader">
        <div style="width: 150px; height: 150px;" id="lottieLoader"></div>
        <p style="font-family: 'Fredoka One'; color: #ff4d6d; margin-top: 10px; font-size: 1.5rem; animation: pulse 1s infinite;">Loading Love...</p>
    </div>
    <style>@keyframes pulse{0%,100%{opacity:1;}50%{opacity:0.5;}}</style>

    <!-- MUSIC TOAST -->
    <div id="musicToast">
        <span>üéµ</span>
        <span id="toastText">Now Playing...</span>
    </div>

    <video id="bgVideo" playsinline autoplay muted loop>
        <source src="" type="video/mp4">
    </video>
    <div class="video-overlay"></div>

    <div id="musicControl" onclick="togglePlaylist()">
        <div class="note-icon">üéµ</div>
        <div id="currentSongLabel">Click for Music</div>
    </div>

    <audio id="bgMusic" loop>
        <source src="" type="audio/mp3">
    </audio>

    <div id="playlistModal" class="playlist-overlay">
        <div class="playlist-card">
            <div class="playlist-header">
                <h2>For Miss Blue üéß</h2>
                <button class="close-plist" onclick="togglePlaylist()">‚úñ</button>
            </div>
    
            <div class="playlist-scroll">
                <div class="genre-section special-section">
                    <h3>‚ù§Ô∏è Special For You</h3>
                    <div class="track-item special-track" onclick="playTrack('song8.mp3', 'Her - JVKE', 0, false)">
                        <span class="icon">‚ú®</span>
                        <span class="info"><strong>Her</strong><br><small>JVKE (Special)</small></span>
                    </div>
                </div>
    
                <div class="genre-section">
                    <h3>üåä Telugu (Home)</h3>
                    <div class="track-item" onclick="playTrack('song4.mp3', 'Chuttamalle', 0, false)">
                        <span class="icon">ü¶ã</span>
                        <span class="info"><strong>Chuttamalle</strong><br><small>Devara</small></span>
                    </div>
                </div>
    
                <div class="genre-section">
                    <h3>üåπ Bengali</h3>
                    <div class="track-item" onclick="playTrack('song1.mp3', 'Obhodro Prem', 0, false)">
                        <span class="icon">üçÇ</span>
                        <span class="info"><strong>Obhodro Prem</strong><br><small>Bengali Vibe</small></span>
                    </div>
                </div>
    
                <div class="genre-section">
                    <h3>üé¨ Hindi</h3>
                    <div class="track-item" onclick="playTrack('song3.mp3', 'Gulaabo', 0, false)">
                        <span class="icon">üíÉ</span>
                        <span class="info"><strong>Gulaabo</strong><br><small>Shaandaar</small></span>
                    </div>
                    <div class="track-item" onclick="playTrack('song5.mp3', 'Mere Sapno Ki Rani', 0, false)">
                        <span class="icon">üöÇ</span>
                        <span class="info"><strong>Mere Sapno Ki Rani</strong><br><small>Classic Retold</small></span>
                    </div>
                </div>
    
                <div class="genre-section">
                    <h3>üå¥ Vibe (Malayalam)</h3>
                    <div class="track-item" onclick="playTrack('song2.mp3', 'Kiliye Kiliye', 5, false)">
                        <span class="icon">ü¶ú</span>
                        <span class="info"><strong>Kiliye Kiliye</strong><br><small>Afrobeat Mix</small></span>
                    </div>
                </div>
    
                <div class="genre-section">
                    <h3>üé∏ English</h3>
                    <div class="track-item" onclick="playTrack('song6.mp3', 'Perfect', 0, false)">
                        <span class="icon">üá¨üáß</span>
                        <span class="info"><strong>Perfect</strong><br><small>One Direction</small></span>
                    </div>
                    <div class="track-item" onclick="playTrack('song7.mp3', 'Just For You', 0, false)">
                        <span class="icon">üåü</span>
                        <span class="info"><strong>Just for you</strong><br><small>English Hit</small></span>
                    </div>
                </div>
            </div>

            <!-- Player Controls -->
            <div class="playlist-footer">
                <button class="ctrl-btn" onclick="previousTrack()">‚èÆ</button>
                <button class="ctrl-btn play-pause-btn" id="mainPlayBtn" onclick="pauseTrack()">‚è∏</button>
                <button class="ctrl-btn" onclick="nextTrack()">‚è≠</button>
            </div>
        </div>
    </div>

    <div id="blueFollowerContainer"><div id="lFollow" style="width:100%; height:100%;"></div></div>

    <div class="container visible" id="screen1">
        <div style="height: 100px;"></div>
        <h1 class="shimmer-text">Miss Blue?</h1>
        <p>Will you be my Valentine?</p>
        
        <div class="btn-container">
            <button class="btn-yes" onclick="sayYes(event)">YES PLEASE</button>
            <button class="btn-no" id="noBtn" onmouseover="moveBtn()" onclick="moveBtn()" ontouchstart="moveBtn()">NO</button>
        </div>
    </div>

    <!-- SCREEN 2 WITH NEW BUBBLE BUTTONS -->
    <div class="container hidden" id="screen2">
        <div style="height: 50px;"></div>
        <h1 class="shimmer-text">Yay! Choose a Gift:</h1>
        
        <div class="gift-grid">
            <!-- Gift 1: Bloom -->
            <div class="gift-wrapper" onclick="openGift('gift1')">
                <div class="gift-bubble">
                    <img src="1.png" alt="Bloom">
                </div>
                <div class="gift-label">Bloom</div>
            </div>

            <!-- Gift 2: Letter -->
            <div class="gift-wrapper" onclick="openGift('gift2')">
                <div class="gift-bubble">
                    <img src="2.png" alt="Letter">
                </div>
                <div class="gift-label">Letter</div>
            </div>

            <!-- Gift 3: Unwrap -->
            <div class="gift-wrapper" onclick="openGift('gift3')">
                <div class="gift-bubble">
                    <img src="3.png" alt="Unwrap">
                </div>
                <div class="gift-label">Unwrap</div>
            </div>

            <!-- Gift 4: For Us -->
            <div class="gift-wrapper" onclick="window.location.href='https://ishan-ran.github.io/For-us/'">
                <div class="gift-bubble">
                    <img src="4.png" alt="For Us">
                </div>
                <div class="gift-label">For Us</div>
            </div>
        </div>
    </div>

    <!-- GIFT OVERLAYS -->
    <div class="overlay" id="gift1">
        <div id="lottieCherry"></div>
        <h2 id="bloomText" style="color: #ff4d6d; font-family: 'Fredoka One'">Tap to Bloom</h2>
        <div id="flowerGame" class="flower-stage" onclick="growFlower(event)">üå±</div>
        <div id="lottieValentine"></div>
        <button class="close-btn" onclick="closeGift('gift1')">Back</button>
    </div>

    <div class="overlay" id="gift2">
        <div class="letter-paper">
            <div class="deco-flower" style="top: 15px; left: 15px;">üå∏</div>
            <div class="deco-flower" style="top: 15px; right: 15px;">üå∏</div>
            <div class="deco-flower" style="bottom: 15px; right: 15px;">üå∏</div>
            <div class="deco-flower" style="bottom: 15px; left: 15px;">üå∏</div>
            
            <div class="letter-title">My letter to you</div>
            <div id="letterContent"></div>
        </div>
        <button class="close-btn" onclick="closeGift('gift2')">Close Letter</button>
    </div>

    <div class="overlay" id="gift3">
        <h2 id="unwrapText" style="color: #ff4d6d; font-family: 'Fredoka One'">Tap to Unwrap!</h2>
        <div id="giftBox" class="wrapped-box" onclick="unwrapGift(event)">üéÅ</div>
        <div id="lottieChocolate"></div>
        <div id="sweetMsg" class="hidden" style="margin-top: 20px; font-weight: bold; color: #590d22; font-size: 1.5rem; font-family: 'Indie Flower'">You are sweeter than this!</div>
        <button class="close-btn" onclick="closeGift('gift3')">Back</button>
    </div>

    <script>
        // --- 1. ASSETS ---
        try { lottie.loadAnimation({ container: document.getElementById('lFollow'), renderer: 'svg', loop: true, autoplay: true, path: 'blue.json' }); } catch(e) {}
        
        // Loader Animation
        try { lottie.loadAnimation({ container: document.getElementById('lottieLoader'), renderer: 'svg', loop: true, autoplay: true, path: 'valentine.json' }); } catch(e) {}

        var animValentine, animCherry, animChocolate;
        try {
            animValentine = lottie.loadAnimation({ container: document.getElementById('lottieValentine'), renderer: 'svg', loop: true, autoplay: false, path: 'valentine.json' });
            animCherry = lottie.loadAnimation({ container: document.getElementById('lottieCherry'), renderer: 'svg', loop: true, autoplay: false, path: 'cherry.json' });
            animChocolate = lottie.loadAnimation({ container: document.getElementById('lottieChocolate'), renderer: 'svg', loop: true, autoplay: false, path: 'chocolate.json' });
        } catch(e) {}

        // Remove Loader on Load
        window.addEventListener('load', () => {
            const loader = document.getElementById('loader');
            setTimeout(() => {
                loader.style.opacity = '0';
                setTimeout(() => loader.remove(), 800);
            }, 1500); // Wait 1.5s for effect
        });

        // --- DEVICE MODE DETECTION ---
        let isMobileMode = window.innerWidth <= 768;

        function checkDeviceMode() {
            const wasMobile = isMobileMode;
            isMobileMode = window.innerWidth <= 768;
            if(wasMobile !== isMobileMode) {
                console.log(isMobileMode ? "üì± Mobile Mode Activated" : "üíª Desktop Mode Activated");
            }
        }

        // Check on load and on resize
        checkDeviceMode();
        window.addEventListener('resize', checkDeviceMode);

        // --- 2. PARTICLES ---
        function createParticles(x, y) {
            for(let i=0; i<30; i++) {
                let p = document.createElement('div'); p.className = 'particle'; document.body.appendChild(p);
                let angle = Math.random() * Math.PI * 2, velocity = Math.random() * 100 + 50;
                p.style.left = x + 'px'; p.style.top = y + 'px';
                p.style.setProperty('--tx', Math.cos(angle) * velocity + 'px');
                p.style.setProperty('--ty', Math.sin(angle) * velocity + 'px');
                p.style.background = ['#ff4d6d', '#ffccd5', '#ffffff'][Math.floor(Math.random()*3)];
                p.style.animation = `explode 0.8s ease-out forwards`;
                setTimeout(() => p.remove(), 800);
            }
        }

        // --- 3. MUSIC PLAYER LOGIC ---
        let currentTrackIndex = 1; // Start with Chuttamalle (index 1 based on playlist below)
        const playlist = [
            { filename: 'song8.mp3', title: 'Her - JVKE', startTime: 0 },
            { filename: 'song4.mp3', title: 'Chuttamalle', startTime: 0 },
            { filename: 'song1.mp3', title: 'Obhodro Prem', startTime: 0 },
            { filename: 'song3.mp3', title: 'Gulaabo', startTime: 0 },
            { filename: 'song5.mp3', title: 'Mere Sapno Ki Rani', startTime: 0 },
            { filename: 'song2.mp3', title: 'Kiliye Kiliye', startTime: 5 },
            { filename: 'song6.mp3', title: 'Perfect', startTime: 0 },
            { filename: 'song7.mp3', title: 'Just for you', startTime: 0 }
        ];

        function togglePlaylist() {
            const modal = document.getElementById('playlistModal');
            if(modal.classList.contains('show')) {
                modal.classList.remove('show');
                setTimeout(() => modal.style.display = 'none', 300);
            } else {
                modal.style.display = 'flex';
                setTimeout(() => modal.classList.add('show'), 10);
            }
        }

        function playTrack(filename, title, startTime, toggleList) {
            const trackIndex = playlist.findIndex(t => t.filename === filename);
            if(trackIndex !== -1) currentTrackIndex = trackIndex;

            const audio = document.getElementById('bgMusic');
            const label = document.getElementById('currentSongLabel');
            const playBtn = document.getElementById('mainPlayBtn');

            // Update the source element properly
            const source = audio.querySelector('source');
            source.src = "./" + filename;
            audio.load();
            label.innerText = "üéµ " + title;
            
            audio.onloadedmetadata = function() {
                if(startTime > 0) audio.currentTime = startTime;
                audio.play();
                playBtn.innerHTML = "‚è∏";
            };
            
            // Fallback play
            setTimeout(() => {
                if(startTime > 0 && audio.currentTime < startTime) audio.currentTime = startTime;
                audio.play().catch(e => console.log("Interaction needed first"));
                playBtn.innerHTML = "‚è∏";
            }, 100);

            if(toggleList) togglePlaylist();
            
            // Visual feedback on button
            const btn = document.getElementById('musicControl');
            btn.style.borderColor = "#ff4d6d";
            btn.style.background = "#fff0f5";

            // FEATURE 5: SHOW TOAST
            const toast = document.getElementById('musicToast');
            document.getElementById('toastText').innerText = "Now Playing: " + title;
            toast.classList.add('show-toast');
            setTimeout(() => toast.classList.remove('show-toast'), 3000);
        }

        function nextTrack() {
            currentTrackIndex++;
            if(currentTrackIndex >= playlist.length) currentTrackIndex = 0;
            const track = playlist[currentTrackIndex];
            playTrack(track.filename, track.title, track.startTime, false);
        }

        function previousTrack() {
            currentTrackIndex--;
            if(currentTrackIndex < 0) currentTrackIndex = playlist.length - 1;
            const track = playlist[currentTrackIndex];
            playTrack(track.filename, track.title, track.startTime, false);
        }

        function pauseTrack() {
            const audio = document.getElementById('bgMusic');
            const playBtn = document.getElementById('mainPlayBtn');
            if(audio.paused) {
                audio.play();
                playBtn.innerHTML = "‚è∏";
            } else {
                audio.pause();
                playBtn.innerHTML = "‚ñ∂";
            }
        }

        // --- 4. BUTTERFLY ---
        const bFollow = document.getElementById('blueFollowerContainer');
        let bx = window.innerWidth/2, by = window.innerHeight/2, tx = bx, ty = by, isResting = false, isClick = false, restT;
        function animateButterfly() {
            if (!isResting) {
                let dx = tx - bx, dy = ty - by, dist = Math.sqrt(dx*dx + dy*dy);
                if(dist < 5) { if(isClick) { isClick = false; isResting = true; restT = setTimeout(()=>isResting=false,5000); } else { tx=Math.random()*innerWidth; ty=Math.random()*innerHeight; } }
                bx += dx * 0.025; by += dy * 0.025;
            }
            bFollow.style.transform = `translate3d(${bx-75}px, ${by-75}px, 0) rotate(${(tx-bx)*0.05}deg)`;
            requestAnimationFrame(animateButterfly);
        }
        animateButterfly();
        document.addEventListener('click', (e) => {
            // REMOVED THE FLOATING HEARTS LOGIC AS REQUESTED
            if(e.target.tagName !== 'BUTTON' && !e.target.closest('.gift-wrapper') && !e.target.closest('#playlistModal') && !e.target.closest('#musicControl') && !e.target.closest('#playerControls')) {
                tx = e.clientX; ty = e.clientY; isClick = true; isResting = false; clearTimeout(restT);
                // createHeart(e.clientX, e.clientY); // Disabled
            }
        });

        // --- 5. LOGIC ---
        function sayYes(e) {
            if(e) createParticles(e.clientX, e.clientY);
            // Play song automatically (Obhodro Prem - Index 2)
            playTrack('song1.mp3', 'Obhodro Prem', 0, false);
            
            document.getElementById('screen1').classList.replace('visible', 'hidden');
            setTimeout(() => { 
                document.getElementById('screen2').classList.replace('hidden', 'visible');
                tx = innerWidth/2; ty = innerHeight/2; isClick = true;
            }, 500);
        }

        // --- NO BUTTON CYCLING LOGIC ---
        const noTexts = [
            "Are you sure?", "Really?", "Think again", "Wait wait", "Hold on", "Nope üòå", "Try again", "Don‚Äôt rush",
            "You sure sure?", "Hmm ü§®", "That‚Äôs a bold choice", "Double check that", "Second thoughts?", "Careful now",
            "Oops wrong one", "Not that one", "Nice try", "Almost clicked yes", "Misclick?", "That button bites",
            "Suspicious choice", "Pause", "Rethink", "Loading doubt‚Ä¶", "Error: bad decision", "System says no",
            "Heart disagrees", "That hurts", "Why though", "Excuse me?", "Uh oh", "Try the other button", "Wrong answer",
            "Incorrect ‚ùå", "Close one", "You missed", "Plot twist", "Not today", "Are you brave?", "Are you stubborn?",
            "Are you testing me?", "That‚Äôs illegal", "Button says run", "This button is shy", "Don‚Äôt touch me", "I move fast",
            "Too slow", "Missed again", "Hehe", "Nope nope", "Absolutely not", "Bold but wrong", "That ain‚Äôt it",
            "Are you playing games?", "Choose wisely", "Fate says no", "Destiny rerouting", "Think of the vibes",
            "Vibes say yes", "Why no üòî", "That‚Äôs cold", "Heart cracked üíî", "I‚Äôm offended", "Try again pls", "Please reconsider",
            "Be kind", "Be nice", "Be honest", "Be brave", "Be soft", "Be sweet", "Wrong energy", "Try love", "Choose love",
            "Love is pink", "Pink means yes", "Red is waiting", "Blue knows better", "Blue don‚Äôt lie", "You‚Äôre smiling aren‚Äôt you",
            "I know you are", "Caught you", "Still no?", "Wow", "Unbelievable", "That‚Äôs wild", "That‚Äôs crazy", "No way",
            "Ain‚Äôt no way", "Are you serious", "Dead serious?", "Last chance", "Final warning", "Button relocating", "Escaping‚Ä¶",
            "Running away", "Too powerful", "Can‚Äôt catch me", "Fast hands", "Slow choice", "Missed opportunity", "You blinked",
            "Try harder", "You‚Äôre persistent", "Respect", "But still no", "Plot armor activated", "NPC says no",
            "Main character says yes", "Choose main story", "Side quest denied", "Achievement locked", "Unlock required",
            "Requires YES", "Insufficient affection", "Error 404: No gone", "Button unavailable", "Connection lost", "Signal weak",
            "Heart stronger", "Logic failing", "Emotions loading", "Patience please", "Still thinking?", "Time‚Äôs ticking",
            "Clock judging you", "Butterfly watching", "Blue butterfly judging", "Butterfly says yes", "Butterfly knows",
            "Don‚Äôt argue", "Trust the process", "Universe laughing", "Stars disagree", "Moon says yes", "Sun says yes", "Why no",
            "Explain yourself", "Just one yes", "Tiny yes", "Small yes", "Soft yes", "Quiet yes", "Loud yes", "Yes pls",
            "Say it", "Type yes", "Click yes", "Hover yes", "You want to", "I know you do", "You‚Äôre lying", "Be honest",
            "Stop resisting", "Accept fate", "Lean into it", "Let go", "Smile first", "Then click yes", "Don‚Äôt be mean",
            "Don‚Äôt be cruel", "Don‚Äôt tease", "Okay tease a little", "But still yes", "I‚Äôm tired", "Running away again",
            "Still here?", "Wow dedication", "Impressive", "But unnecessary", "Yes is easier", "Less effort", "More happiness",
            "Math checks out", "Logic agrees", "Heart wins", "Brain surrendered", "Why fight it", "Join the dark side",
            "We have love", "Wrong team", "Switch teams", "Respawn", "Retry", "New attempt", "Same result", "No escaped again",
            "Almost had it", "So close", "Closer than before", "Not close enough", "Try opposite", "Mirror universe says yes",
            "Multiverse agrees", "Every universe agrees", "Except this click", "Fix that", "Correct it", "Undo", "Redo",
            "Yes is redo", "No is undo", "Undo this choice", "Please", "Pretty please", "With a cherry", "With a rose",
            "With chocolate", "With music", "With butterflies", "With everything", "Why no still", "Stubborn much", "I admire it",
            "But no", "Button teleporting", "Can‚Äôt touch this", "MC Hammer moment", "Dodging", "Weaving", "Slipping",
            "Gone again", "Still chasing", "This is fun", "You‚Äôre enjoying this", "I know you are", "Smile check", "Grin detected",
            "Laugh detected", "Caught red-handed", "Okay stop", "Click yes now", "Enough drama", "End scene", "Roll credits",
            "Happy ending unlocked", "Requires yes", "Still locked", "Key missing", "Key = yes", "Find the key", "Hint: pink button",
            "Hint again: yes", "Final hint: YES", "Okay last one", "Seriously last", "No more tricks", "Promise",
            "Unless you click no", "Then more tricks", "So don‚Äôt", "Choose peace", "Choose joy", "Choose yes"
        ];
        let noClickCount = 0;

        function moveBtn() {
            const b = document.getElementById('noBtn');
            b.style.position = 'fixed'; 
            b.style.left = Math.random()*(innerWidth-100)+'px'; 
            b.style.top = Math.random()*(innerHeight-100)+'px';
            
            // Cycle text logic
            b.innerText = noTexts[noClickCount % noTexts.length];
            noClickCount++;
        }

        function createHeart(x, y) {
            const h = document.createElement('div'); h.innerText = "‚ù§Ô∏è"; h.className = 'touch-heart';
            h.style.left = x+'px'; h.style.top = y+'px'; document.body.appendChild(h); setTimeout(()=>h.remove(),1000);
        }
        function openGift(id) {
            document.getElementById(id).style.display = 'flex';
            createParticles(innerWidth/2, innerHeight/2);
            if(id === 'gift1') resetFlower();
            if(id === 'gift2') writeLetter();
            if(id === 'gift3') resetWrapper();
        }
        function closeGift(id) { document.getElementById(id).style.display = 'none'; }

        // --- GAMES ---
        let bloomCount = 0;
        function resetFlower() { bloomCount = 0; document.getElementById('flowerGame').innerHTML = "üå±"; document.getElementById('flowerGame').style.display = "block"; document.getElementById('lottieValentine').style.display = "none"; document.getElementById('lottieCherry').style.display = "none"; document.getElementById('bloomText').innerText = "Tap to Bloom"; if(animValentine) animValentine.stop(); }
        function growFlower(e) {
            bloomCount++; if(e) createParticles(e.clientX, e.clientY);
            const f = document.getElementById('flowerGame');
            if(bloomCount === 1) f.innerHTML = "üåø"; if(bloomCount === 2) f.innerHTML = "üåπ";
            if(bloomCount === 3) { f.style.display = "none"; document.getElementById('lottieValentine').style.display = "block"; if(animValentine) animValentine.play(); document.getElementById('lottieCherry').style.display = "block"; if(animCherry) animCherry.play(); document.getElementById('bloomText').innerText = "For You!"; createParticles(innerWidth/2, innerHeight/2); }
        }

        // --- LETTER LOGIC (UPDATED WITH HIGHLIGHTS) ---
        let hasTyped = false;
        function writeLetter() {
            if(hasTyped) return; hasTyped = true;
            const element = document.getElementById('letterContent');
            const htmlText = `
                <strong>Dear Blue,</strong><br><br>
                I‚Äôve been sitting here for a while now, just thinking about you and thinking about today. It‚Äôs our first Valentine‚Äôs Day, and even though this is all pretty new, I didn‚Äôt want to let the day pass without writing something real for you. Not something polished or dramatic, just something honest, something that sounds like me when I let my thoughts wander back to you again and again.<br><br>
                I was thinking about the way we communicate, and honestly, it‚Äôs one of my favorite things about us. Conversations flow, pause, pick up again, and somehow never feel unfinished. Whenever your name pops up on my phone, <span class="highlight">I get this immediate spark of excitement</span>, like the day quietly improves on the spot.<br><br>
                And if I‚Äôm being completely honest, as much as I like seeing your name on my screen, <span class="highlight">hearing your voice is on a whole different level</span>. It feels closer, warmer, more real. Your voice has quickly become one of the things I look forward to the most.<br><br>
                Then there‚Äôs you. <span class="highlight">You‚Äôre incredibly pretty, and I don‚Äôt say that lightly.</span> Even though we haven‚Äôt met in person yet, that doesn‚Äôt change how much I appreciate seeing you. You leave an impression without trying, and that‚Äôs rare.<br><br>
                I think a lot about the future, not in a heavy or serious way, but in a hopeful one. I imagine us exploring places together, wandering through cities we‚Äôve never been to. <span class="highlight">I‚Äôd love to see the world with you</span>, one place at a time, not to tick boxes, but to experience things side by side.<br><br>
                I keep thinking about the day we finally meet. I don‚Äôt think it‚Äôll feel like two strangers at all. <span class="highlight">It‚Äôll feel like two people who already know each other‚Äôs laughs finally being in the same space.</span> Like everything we‚Äôve built through words and voices will simply step into something more real.<br><br>
                There‚Äôs something romantic about the way this is unfolding. No rush, no pressure, just genuine connection growing naturally. I like imagining moments that don‚Äôt need to be big to matter.<br><br>
                So today, I just want you to know that you matter to me. <span class="highlight">You‚Äôve become someone special in my life</span>, someone I genuinely look forward to, someone I‚Äôm grateful to have found.<br><br>
                <span class="highlight">Happy Valentine‚Äôs Day, Blue.</span> I‚Äôm really glad you‚Äôre here.<br><br>
                <div style="text-align: right; color: #d90429; font-weight: bold; margin-top:20px; font-family:'Indie Flower'; font-size:1.4rem;">
                    Yours,<br>Red. <br><span style="font-size: 0.8rem; color: #ff8fa3;">(Prematho...)</span>
                </div>
                <br>
            `;
            element.innerHTML = "";
            let temp = document.createElement('div'); temp.innerHTML = htmlText;
            let nodes = Array.from(temp.childNodes); let cursor = 0;
            function typeNode() {
                if(cursor >= nodes.length) return;
                let node = nodes[cursor];
                if(node.nodeType === 3) {
                    let text = node.textContent; let i = 0;
                    let span = document.createElement('span'); element.appendChild(span);
                    let timer = setInterval(() => {
                        span.textContent += text[i]; i++;
                        if(i >= text.length) { clearInterval(timer); cursor++; typeNode(); }
                    }, 20);
                } else {
                    element.appendChild(node.cloneNode(true)); cursor++; setTimeout(typeNode, 100);
                }
            }
            typeNode();
        }

        // Unwrap
        let shakeCount = 0;
        function resetWrapper() { shakeCount = 0; document.getElementById('giftBox').style.display = "block"; document.getElementById('giftBox').classList.remove('shake'); document.getElementById('lottieChocolate').style.display = "none"; document.getElementById('sweetMsg').style.display = "none"; document.getElementById('unwrapText').innerText = "Tap to Unwrap!"; if(animChocolate) animChocolate.stop(); }
        function unwrapGift(e) {
            shakeCount++; if(e) createParticles(e.clientX, e.clientY);
            const box = document.getElementById('giftBox'); box.classList.remove('shake'); void box.offsetWidth; box.classList.add('shake');
            if(shakeCount >= 4) { box.style.display = "none"; document.getElementById('lottieChocolate').style.display = "block"; if(animChocolate) animChocolate.play(); document.getElementById('sweetMsg').style.display = "block"; document.getElementById('unwrapText').innerText = "Enjoy!"; createParticles(innerWidth/2, innerHeight/2); }
        }
    </script>
</body>
</html>